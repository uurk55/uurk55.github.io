{{ define "main" }}

<header class="page-header">
    {{ $title := .Title }}
    {{ if eq .Data.Singular "category" }}
        {{ $title = "Kategoriler" }}
    {{ else if eq .Data.Singular "tag" }}
        {{ $title = "Etiketler" }}
    {{ else if eq .Data.Singular "series" }}
        {{ $title = "Yazı Dizileri" }}
    {{ end }}
    <h1>{{ $title }}</h1>
</header>

<div class="category-card-grid">
    {{- range .Data.Terms.ByCount -}}
    
    {{ $currentCategoryTitle := .Page.Title }}
    {{ $bgImage := "/images/cat-bg-default.png" }}
    {{ $description := "" }}

    {{/* Veri dosyasından resmi bul */}}
    {{- range site.Data.categories -}}
        {{- if eq .category $currentCategoryTitle -}}
            {{- $bgImage = printf "/images/%s" .image -}}
        {{- end -}}
    {{- end -}}

    {{/* --- KESİN ÇÖZÜM BURADA --- */}}
    {{/* Açıklamayı bulmak için TÜM content/categories dosyalarını tara */}}
    {{ $categoryContentPages := where site.Pages "Section" "categories" }}
    {{- range $categoryContentPages -}}
        {{/* İsimleri küçük harfe çevirerek karşılaştır (en garantili yöntem) */}}
        {{- if eq (.Title | lower) ($currentCategoryTitle | lower) -}}
            {{- $description = .Description -}}
        {{- end -}}
    {{- end -}}


    <a href="{{ .Page.Permalink }}" class="category-card" style="background-image: url('{{ $bgImage | safeURL }}');">
        <div class="card-overlay"></div>
        <div class="card-content">
            <h2 class="card-title">{{ .Page.Title }}</h2>
            
            {{ if $description }}
            <p class="card-description">{{ $description }}</p>
            {{ end }}

            <span class="card-count">{{ .Count }} YAZI</span>
        </div>
    </a>
    {{- end -}}
</div>

{{ end }}